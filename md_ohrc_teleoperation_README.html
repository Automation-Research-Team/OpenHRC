<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OpenHRC: ohrc_teleoperation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OpenHRC
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">ohrc_teleoperation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The <code>ohrc_teleoperation</code> package provides diverse teleoperation interfaces for OpenHRC. These are built on the <a class="el" href="classInterface.html">Interface</a> class in <code>ohrc_control/interface.h</code>.</p>
<h1><a class="anchor" id="autotoc_md9"></a>
Rule for launch files</h1>
<p>To launch files, use the following command: </p><div class="fragment"><div class="line">roslaunch ohrc_teleoperation (interface)_teleoperation.launch robot:=(robot) controller:=(controller)</div>
</div><!-- fragment --><p>The table below lists the currently tested and implemented options for the parameters: </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">argument   </th><th class="markdownTableHeadLeft">options    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">interface   </td><td class="markdownTableBodyLeft">marker, omega, state_topic, twist_topic, joy_topic    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">robot   </td><td class="markdownTableBodyLeft">ur5e, fetch, seed, mycobot, toroboarm, crane_x7    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">controller   </td><td class="markdownTableBodyLeft">vel, vel_trj, pos_trj   </td></tr>
</table>
<p>Please refer to the examples provided to understand each option in detail.</p>
<h1><a class="anchor" id="autotoc_md10"></a>
Example - Teleoperation using interactive marker</h1>
<h2><a class="anchor" id="autotoc_md11"></a>
Velocity level controller (Recommended)</h2>
<p>To effectively control a robot, a velocity-level controller is recommended.</p>
<h3><a class="anchor" id="autotoc_md12"></a>
UR5e</h3>
<p>The UR5e default controller is <code><a class="el" href="classJointTrajectoryController.html">JointTrajectoryController</a></code>. If you need to load <code>JointVelocityController</code> in the controller list configuration, refer to the modification file for the gazebo simulation located in the <code>./example</code> directory. If you require the original (default) controller settings due to issues like low control frequency (&lt; 100 Hz), please refer to the Trajectory level controller section.</p>
<p>Use the following commands to launch the modified gazebo simulation with UR5e and the teleoperation controller: </p><div class="fragment"><div class="line"># launch modified gazebo simulation with UR5e</div>
<div class="line">$ roslaunch ohrc_hw_config ur5e_bringup.launch</div>
<div class="line"> </div>
<div class="line"># launch teleoperation controller</div>
<div class="line">$ roslaunch ohrc_teleoperation marker_teleoperation.launch</div>
</div><!-- fragment --><p>If using real hardware with <a href="https://github.com/UniversalRobots/Universal_Robots_ROS_Driver"><code>ur_robot_driver</code></a>, ensure that the loaded controller is checked. You may need to stop the default trajectory controller and start the loaded velocity controller <a href="https://github.com/UniversalRobots/Universal_Robots_ROS_Driver/blob/7b6b62bf81f2a032e0b6c7c8e1046cae35e079c7/ur_robot_driver/config/ur5e_controllers.yaml#L129">here</a>.</p>
<h2><a class="anchor" id="autotoc_md13"></a>
Trajectory level controller</h2>
<p>If your robot controller can only accept low-frequency commands (&lt; 100), you may send a trajectory (position) command instead of a velocity command. While the trajectory controller is theoretically more stable than the velocity controller, it can take considerable time to adjust the parameters for smoother robot movement.</p>
<p>If you're patient, you can achieve superior motion, as demonstrated in the following paper:</p>
<p>&gt;Jun Nakanishi, Shunki Itadera, Tadayoshi Aoyama &amp; Yasuhisa Hasegawa (2020) Towards the development of an intuitive teleoperation system for human support robot using a VR device, Advanced Robotics, 34:19, 1239-1253, DOI: 10.1080/01691864.2020.1813623</p>
<h3><a class="anchor" id="autotoc_md14"></a>
UR5e</h3>
<p>If you use the original ur5e (6 DoF) configuration, please run </p><div class="fragment"><div class="line"># launch original gazebo simulation with UR5e</div>
<div class="line">$ roslaunch ur_gazebo ur5e_bringup.launch</div>
<div class="line"> </div>
<div class="line"># launch one of the following teleoperation controllers using a topic interface of JointTrajectoryController</div>
<div class="line"># 1) angle position-based trajectory controller</div>
<div class="line">$ roslaunch ohrc_teleoperation marker_teleoperation.launch controller:=pos_trj</div>
<div class="line"> </div>
<div class="line"># Or 2) angle velocity-based trajectory controller</div>
<div class="line">$ roslaunch ohrc_teleoperation marker_teleoperation.launch controller:=vel_trj</div>
</div><!-- fragment --><p> The two controllers differ in the method of solving IK. The first is based on IK finding the optimal joint angle, and the second uses differential IK to find the optimal joint angular velocity.</p>
<p>The first controller may often fail to solve the IK problem within the predefined time period in our current implementation. The second seems more efficient in terms of computational cost. However, in a low-frequency system, the second controller may cause large errors or oscillations due to numerical integration used to obtain the target angle from angular velocity. In such cases, please try using the IK-based controller.</p>
<h3><a class="anchor" id="autotoc_md15"></a>
Fetch</h3>
<p>If you use Fetch robot (8 DoF) (which is not included in this package installation), please run </p><div class="fragment"><div class="line">## install gazebo simulation of Fetch Robot like</div>
<div class="line">$ cd ~/catkin_ws/src</div>
<div class="line">$ git clone -b gazebo11 https://github.com/ZebraDevs/fetch_gazebo.git </div>
<div class="line">$ cd fetch_gazebo</div>
<div class="line">$ rosdep install -i -y --from-paths ./ </div>
<div class="line">$ catkin build -DCMAKE_BUILD_TYPE=Release</div>
<div class="line"> </div>
<div class="line"># launch original gazebo simulation with Fetch</div>
<div class="line">$ roslaunch fetch_gazebo simulation.launch</div>
<div class="line"> </div>
<div class="line"># launch the following teleoperation controller using the action interface of JointTrajectoryController</div>
<div class="line">$ roslaunch ohrc_teleoperation marker_teleoperation.launch robot:=fetch controller:=vel_trj</div>
</div><!-- fragment --><p> This example includes a position-based trajectory controller (<code>controller:=pos_trj</code>) as well.</p>
<h3><a class="anchor" id="autotoc_md16"></a>
Seed-noid (SEED-R7)</h3>
<p>If you use SEED-R7 (only left arm, 7 DoF) (which is not included in this package installation), please run </p><div class="fragment"><div class="line">## install gazebo simulation of Fetch Robot like</div>
<div class="line">$ cd ~/catkin_ws/src</div>
<div class="line">$ git clone https://github.com/seed-solutions/seed_smartactuator_sdk</div>
<div class="line">$ git clone https://github.com/seed-solutions/seed_r7_ros_pkg.git</div>
<div class="line">$ cd seed_r7_ros_pkg</div>
<div class="line">$ rosdep install -i -y --from-paths ./ </div>
<div class="line">$ catkin build -DCMAKE_BUILD_TYPE=Release</div>
<div class="line"> </div>
<div class="line"># launch gazebo simulation with Seed</div>
<div class="line">$ roslaunch seed_r7_gazebo seed_r7_empty_world.launch</div>
<div class="line"> </div>
<div class="line"># launch the following teleoperation controller using topic interface of JointTrajectoryController</div>
<div class="line">$ roslaunch ohrc_teleoperation marker_teleoperation.launch robot:=seed controller:=vel_trj</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md17"></a>
myCobot</h3>
<p>If you use myCobot (which is not included in this package installation), please run </p><div class="fragment"><div class="line">## install gazebo simulation of Fetch Robot like</div>
<div class="line">$ cd ~/catkin_ws/src</div>
<div class="line">$ git clone https://github.com/Tiryoh/mycobot_ros.git</div>
<div class="line">$ cd mycobot_ros</div>
<div class="line">$ rosdep install -i -y --from-paths ./ </div>
<div class="line">$ catkin build -DCMAKE_BUILD_TYPE=Release</div>
<div class="line"> </div>
<div class="line"># launch gazebo simulation with myCobot</div>
<div class="line">$ roslaunch mycobot_gazebo mycobot_with_emptyworld.launch</div>
<div class="line"> </div>
<div class="line"># launch the following teleoperation controller using topic interface of JointTrajectoryController</div>
<div class="line">$ roslaunch ohrc_teleoperation marker_teleoperation.launch robot:=mycobot controller:=vel_trj</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md18"></a>
Example - Teleoperation using geometry_msgs/twist topic</h1>
<p>This subscribes twist topic as a commanded velocity of a robot end-effector. </p><div class="fragment"><div class="line">$ rosrun (some nodes to generate command velocity)</div>
<div class="line">$ roslaunch ohrc_teleoperation twist_topic_teleoperation.launch robot:=(robot) controller:=(controller)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md19"></a>
Example - Teleoperation using sensor_msgs/joy topic</h1>
<p>This subscribes joy topic as a velocity command of a robot end-effector. If you have 3D mouse (spacenav) <a href="http://wiki.ros.org/spacenav_node">http://wiki.ros.org/spacenav_node</a> </p><div class="fragment"><div class="line">### install spacenav node</div>
<div class="line">$ sudo apt install spacenavd</div>
<div class="line">$ sudo apt install ros-indigo-spacenav-node</div>
<div class="line"> </div>
<div class="line">$ roslaunch ohrc_teleoperation joy_topic_teleoperation.launch spacenav:=true robot:=(robot) controller:=(controller)</div>
</div><!-- fragment --><p> The arg <code>spacenav:=true</code> launch spacenav node with specific options. The second button (usually RIGHT button) is used as a trigger for resetting robot's pose.</p>
<h1><a class="anchor" id="autotoc_md20"></a>
Example - Teleoperation using haptic interface &lt;tt&gt;Omega&lt;/tt&gt;</h1>
<div class="fragment"><div class="line">$ roslaunch ohrc_teleoperation omega_teleoperation.launch robot:=(robot) controller:=(controller)</div>
</div><!-- fragment --><hr  />
 <h1><a class="anchor" id="autotoc_md22"></a>
Development</h1>
<h2><a class="anchor" id="autotoc_md23"></a>
How to teleoperate a robot from another interface</h2>
<p>The easiest way is just to develop a node publishing a topic of the target end-effector state. The node is assumed that</p>
<ol type="1">
<li>the state topic is published as <code>/state</code> in a type of <code>ohrc_msgs/state</code>.</li>
</ol>
<ol type="1">
<li>the state is defined in <code>world</code>.</li>
</ol>
<p>Then, launch the following nodes: </p><div class="fragment"><div class="line"># launch gazebo simulation (e.g., with UR5e)</div>
<div class="line">$ roslaunch ohrc_teleoperation ur5e_bringup.launch</div>
<div class="line"> </div>
<div class="line"># run the made node publishing </div>
<div class="line">$ rosrun &lt;develoeped node&gt; </div>
<div class="line"> </div>
<div class="line"># launch teleoperation controller</div>
<div class="line">$ roslaunch ohrc_teleoperation state_topic_teleoperation.launch</div>
</div><!-- fragment --><p>Note that,</p><ul>
<li>The translational motion is relative, and the rotational motion is absolute, which means that the user can do "indexing" for translational motion by repeating enable and disable.</li>
<li>The motion is enabled while <code>enabled</code> in <code>ohrc_msgs/state</code> is <code>true</code>.</li>
<li>The reference position of the relative translation is defined when the <code>enabled</code> if switched from <code>false</code> to <code>ture</code>.</li>
</ul>
<p>If you want to add any modifications but still want to use <code>ohrc_msgs/state</code> topic, please make another interface referring to <code><a class="el" href="classStateTopicInterface.html">StateTopicInterface</a></code> class. (see <code><a class="el" href="omega__interface_8cpp.html">omega_interface.cpp</a></code>). For example, this way can add a synchronous feedback function.</p>
<p>If you want to develop from a lower scratch, e.g., calling API of the interface(device) synchronously without pub/sub <code>ohrc_msgs/state</code> topic, please develop another interface node referring to <code><a class="el" href="classMultiCartController.html">MultiCartController</a></code> class. (see <code><a class="el" href="marker__interface_8cpp.html">marker_interface.cpp</a></code>).</p>
<hr  />
 <h1><a class="anchor" id="autotoc_md25"></a>
Author</h1>
<p>Shunki Itadera, Ph.D. (<a href="#" onclick="location.href='mai'+'lto:'+'s.i'+'ta'+'der'+'a@'+'ais'+'t.'+'go.'+'jp'; return false;">s.ita<span style="display: none;">.nosp@m.</span>dera<span style="display: none;">.nosp@m.</span>@aist<span style="display: none;">.nosp@m.</span>.go.<span style="display: none;">.nosp@m.</span>jp</a>) - Researcher at ART, ICPS, AIST </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
